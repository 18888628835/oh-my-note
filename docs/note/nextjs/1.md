# åŸºæœ¬ç”¨æ³•

## page è·¯ç”±

ä»`pages`æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶å¯¼å‡ºçš„æ¯ä¸ª React ç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªé¡µé¢ã€‚

é¡µé¢çš„è·¯ç”±è·Ÿå®ƒä»¬çš„æ–‡ä»¶åæ˜¯ç›¸å…³è”çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼š

1. `pages/index.js`å…³è”çš„æ˜¯`/`
2. `pages/posts/first-post.js`å…³è”åˆ°`/posts/first-post.js`è·¯ç”±

è·¯ç”±è·³è½¬ï¼š

```jsx | pure
import Link from 'next/link'

;<Link href="/posts/first-post">this page!</Link>
```

`Link`ç»„ä»¶å…è®¸åœ¨ä¸¤ä¸ªé¡µé¢é—´è¿›è¡Œå®¢æˆ·ç«¯å¯¼èˆªã€‚

å®¢æˆ·ç«¯å¯¼èˆªæ„å‘³ç€é¡µé¢ä¼šçš„å˜åŒ–æ˜¯ç”¨ JavaScript è¿›è¡Œçš„ï¼Œè¿™æ¯”æµè§ˆå™¨é»˜è®¤çš„å¯¼èˆªæ›´å¿«ã€‚

Next.js ä¼šè‡ªåŠ¨è¿›è¡Œä»£ç æ‹†åˆ†ï¼Œå› æ­¤æ¯ä¸ªé¡µé¢åªåŠ è½½è¯¥é¡µé¢æ‰€éœ€çš„å†…å®¹ã€‚è¿™æ„å‘³ç€å½“ä¸»é¡µè¢«å‘ˆç°æ—¶ï¼Œå…¶ä»–é¡µé¢çš„ä»£ç æœ€åˆä¸ä¼šè¢«æ‰§è¡Œã€‚

è¿™æ ·å¯ä»¥ç¡®ä¿å³ä½¿æ‚¨æœ‰æ•°ç™¾ä¸ªé¡µé¢ï¼Œä¸»é¡µä¹Ÿèƒ½å¿«é€ŸåŠ è½½ã€‚

åªåŠ è½½æ‚¨è¯·æ±‚çš„é¡µé¢çš„ä»£ç ä¹Ÿæ„å‘³ç€é¡µé¢å°†è¢«éš”ç¦»ã€‚å¦‚æœæŸä¸ªé¡µé¢æŠ›å‡ºé”™è¯¯ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†ä»ç„¶å¯ä»¥å·¥ä½œã€‚

æ­¤å¤–ï¼Œåœ¨ Next.js çš„ç”Ÿäº§ç‰ˆæœ¬ä¸­ï¼Œæ¯å½“é“¾æ¥ç»„ä»¶å‡ºç°åœ¨æµè§ˆå™¨çš„è§†å£ä¸­æ—¶ï¼ŒNext.js éƒ½ä¼šè‡ªåŠ¨åœ¨åå°é¢„å–é“¾æ¥é¡µé¢çš„ä»£ç ã€‚

å½“ä½ ç‚¹å‡»é“¾æ¥æ—¶ï¼Œç›®æ ‡é¡µé¢çš„ä»£ç å·²ç»åœ¨åå°åŠ è½½ï¼

## é™æ€èµ„æº

å½“é™æ€èµ„æºæ”¾åœ¨`public`æ–‡ä»¶å¤¹å†…æ—¶ï¼Œåœ¨`public`å†…çš„èµ„æºå¯ä»¥è¢«`pages`é‡Œçš„æ–‡ä»¶ä»æ ¹ç›®å½•ä¸­å¼•å…¥ã€‚

ä¾‹å¦‚ï¼Œåœ¨ `public`æ–‡ä»¶å¤¹å†…å»ºç«‹ä¸€ä¸ª`images`æ–‡ä»¶å¤¹å¹¶æ”¾å…¥å›¾ç‰‡ï¼Œåˆ™å¯ä»¥è¿™ä¹ˆå¼•å…¥ï¼š

```js
import Image from 'next/image'
;<Image src="/images/profile.jpg" alt="Your Name" />
```

å¯¹äºå›¾ç‰‡èµ„æºï¼Œnextjs æä¾›äº†`Image`ç»„ä»¶æ¥å¤„ç†ä»¥ä¸‹åŠŸèƒ½ï¼š

- å›¾ç‰‡å“åº”ä¸åŒçš„å±å¹•å°ºå¯¸
- ç”¨ä¸‰æ–¹å·¥å…·å¯¹å›¾ç‰‡èµ„æºè¿›è¡Œä¼˜åŒ–
- ä»…åœ¨å›¾åƒè¿›å…¥è§†å£æ—¶åŠ è½½å›¾åƒ

`next/image`æ˜¯`HTMLï¼œimgï¼`å…ƒç´ çš„æ‰©å±•ï¼Œå®ƒå…è®¸åœ¨æµè§ˆå™¨æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œä»¥ WebP ç­‰ç°ä»£æ ¼å¼è°ƒæ•´ã€ä¼˜åŒ–å’Œæä¾›å›¾åƒã€‚è¿™æ ·å¯ä»¥é¿å…å°†å¤§å‹å›¾åƒè¿é€åˆ°è§†å£è¾ƒå°çš„è®¾å¤‡ã€‚å®ƒè¿˜å…è®¸ Next.js è‡ªåŠ¨é‡‡ç”¨æœªæ¥çš„å›¾åƒæ ¼å¼ï¼Œå¹¶å°†å…¶æä¾›ç»™æ”¯æŒè¿™äº›æ ¼å¼çš„æµè§ˆå™¨ã€‚

## meta æ•°æ®

å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨é¡µé¢ä¸­å®šä¹‰ meta æ•°æ®ï¼Œä¾‹å¦‚`<title>`æ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`Head`ç»„ä»¶ã€‚

```jsx
import Head from 'next/head'

;<Head>
  <title>Create Next App</title>
  <link rel="icon" href="/favicon.ico" />
</Head>
```

`<Head>`æ˜¯ç”¨æ¥æ›¿ä»£`<head>`æ ‡ç­¾çš„ã€‚

åœ¨ `pages`é‡Œå®šä¹‰çš„æ¯ä¸ªæ–‡ä»¶é‡Œéƒ½å¯ä»¥ç”¨`<Head>`æ ‡ç­¾ï¼Œå½“åŠ è½½åˆ°è¯¥é¡µé¢æ—¶ï¼Œ`nextjs` å°±èƒ½å¤ŸæŠŠ`<Head>`é‡Œé¢çš„ `meta` æ•°æ®ç»™æ³¨å…¥è¿›å»ã€‚

å¼•å…¥ç¬¬ä¸‰æ–¹`script`è„šæœ¬å¤–é“¾çš„æ–¹å¼åˆ™æ˜¯ç”¨`Script`ç»„ä»¶ï¼š

```jsx | pure
import Script from 'next/script'
export default function FirstPost() {
  return (
    <>
      <Head>
        <title>First Post</title>
      </Head>
      <Script
        src="https://cdn.bootcdn.net/ajax/libs/dayjs/1.11.7/dayjs.min.js"
        strategy="lazyOnload"
        onLoad={() => console.log(`script loaded correctly, window.dayjs has been populated`)}
      />
      <h1>First Post</h1>
      <h2>
        <Link href="/">â† Back to home</Link>
      </h2>
    </>
  )
}
```

`Script`ç»„ä»¶å®šä¹‰äº†ä¸€äº›é™„åŠ å±æ€§ï¼š

1. `strategy`æ§åˆ¶ç¬¬ä¸‰æ–¹è„šæœ¬ä½•æ—¶åŠ è½½ã€‚`lazyOnload`å‘Šè¯‰ Next.js åœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´å»¶è¿ŸåŠ è½½è¿™ä¸ªç‰¹å®šçš„è„šæœ¬ã€‚
2. `onLoad`ç”¨äºåœ¨è„šæœ¬å®ŒæˆåŠ è½½åç«‹å³è¿è¡Œä»»ä½• JavaScript ä»£ç 

ä¸Šé¢çš„ä»£ç ä¼šå°† `script` é‡Œçš„å†…å®¹å¼•è¿›é¡µé¢ä¸­ï¼Œè¾“å…¥`window.dayjs`çœ‹åˆ°è¿™ä¸ªå…¨å±€å˜é‡å°±è¡¨ç¤ºå¼•å…¥æˆåŠŸäº†ã€‚

## css

å¦‚æœæƒ³è¦è®¾ç½®å…¨å±€ cssï¼Œåˆ™å¯ä»¥åœ¨`pages/_app.tsx`ä¸­å¼•å…¥ï¼Œä¾‹å¦‚ï¼š

```js
// pages/_app.tsx
import 'src/styles/globals.css'
```

> \_app.tsx é™¤äº†åŠ è½½å…¨å±€ css å¤–ï¼Œè¿˜å¯ä»¥åœ¨è¿™é‡Œå¤„ç†å…¨å±€ stateã€‚

é™¤äº†`_app.tsx`å¤–ï¼Œä»»ä½•å…¶ä»–çš„åœ°æ–¹éƒ½ä¸èƒ½å¼•å…¥å…¨å±€ css

å…¶æ¬¡æ˜¯ `CSS Modules`,nextjs å¼ºåˆ¶è¦æ±‚ css çš„æ–‡ä»¶åæ ¼å¼ä¸º:`.module.css`

ä¸‹é¢æœ‰ä¸€ä¸ª `layout.module.css` æ–‡ä»¶

```css
.container {
  padding: 0 1rem;
}
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å®ä¾‹ï¼š

```jsx | pure
import styles from './layout.module.css'

export default function Layout({ children }) {
  return <div className={styles.container}>{children}</div>
}
```

ä½¿ç”¨è¿™ç§æ–¹å¼å¼•å…¥çš„`className`ä¼šè‡ªåŠ¨åŠ å…¥ hash å€¼ï¼Œç±»ä¼¼`layout_container_2t4v2`è¿™æ ·çš„ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æ‹…å¿ƒç±»åé‡å¤é—®é¢˜ã€‚

åŒæ—¶ï¼ŒNextjs çš„ä»£ç åˆ†å‰²åŠŸèƒ½å¯¹ css æ¨¡å—ä¹Ÿæœ‰ä½œç”¨ï¼Œå®ƒä¼šè®©æ¯ä¸ªé¡µé¢éƒ½åŠ è½½æœ€å°‘çš„ cssã€‚

è¿™äº›æ“ä½œä¼šåœ¨ Nextjs æ„å»ºæ—¶è¿›è¡Œï¼Œå¹¶ä¸”ç”Ÿæˆ css æ–‡ä»¶å¹¶ä¸”åœ¨åŠ è½½åˆ°é¡µé¢ä¸­ã€‚

## Pre-rendering

Nextjs æœ€é‡è¦çš„åŠŸèƒ½æ˜¯ `Pre-rendering`(é¢„æ¸²æŸ“)ï¼Œæ‰€æœ‰é¡µé¢éƒ½é»˜è®¤ä½¿ç”¨é¢„æ¸²æŸ“ï¼Œè¿™æ„å‘³ç€ Nextjs ä¼šæå‰ç»™æ¯ä¸ªé¡µé¢ç”Ÿæˆ HTML è€Œä¸æ˜¯å…¨éƒ¨ä½¿ç”¨ JavaScript åšå®¢æˆ·ç«¯æ¸²æŸ“ã€‚è¿™å¯¹æ€§èƒ½ä»¥åŠ SEO æœ‰å¥½å¤„ã€‚

æ¯ä¸ªç”Ÿæˆçš„ HTML éƒ½ä¸è¯¥é¡µé¢ä¸‹æœ€å°åŒ–æ‰€éœ€çš„ JavaScript ç›¸å…³è”ã€‚å½“é¡µé¢åœ¨æµè§ˆå™¨ä¸­åŠ è½½åï¼Œå®ƒå¯¹åº”çš„ JavaScript ä»£ç ä¼šå¯åŠ¨å¹¶ä¸”ä½¿é¡µé¢å˜å¾—å¯äº¤äº’ï¼ˆè¿™ä¸ªè¿‡ç¨‹å«åš **hydration**,ä¸­æ–‡ç¿»è¯‘æ˜¯**æ°´åˆ**ï¼‰ã€‚

Nextjs ç»™å‡ºäº†ä¸¤å¼ å›¾æ¥å¯¹æ¯” é¢„æ¸²æŸ“ä¸éé¢„æ¸²æŸ“çš„ä¸åŒï¼š

**é¢„æ¸²æŸ“**

![img](https://nextjs.org/static/images/learn/data-fetching/pre-rendering.png)

- é¢„æ¸²æŸ“çš„é¡µé¢è¢«å±•ç¤º
- React ç»„ä»¶è¢«åˆå§‹åŒ–å®Œæˆï¼Œäº§ç”Ÿæ°´åˆä½œç”¨â€”â€”è®©é¡µé¢å˜å¾—å¯äº¤äº’ï¼ˆæ¯”å¦‚åŠ ä¸Šäº†å„ç§äº‹ä»¶ï¼‰

**éé¢„æ¸²æŸ“**

![img](https://nextjs.org/static/images/learn/data-fetching/no-pre-rendering.png)

- é¡µé¢æ²¡æœ‰å†…å®¹
- React ç»„ä»¶è¢«åˆå§‹åŒ–å®Œæˆå¹¶ä¸”é¡µé¢å˜å¾—å¯äº¤äº’ï¼ˆHydrationï¼‰

## SSG å’Œ SSR

Nextjs æœ‰ä¸¤ç§æ–¹å¼çš„é¢„æ¸²æŸ“åˆ†åˆ«æ˜¯ Static Generationï¼ˆç®€ç§° SSGï¼‰å’Œ Server-side Renderingï¼ˆç®€ç§° SSRï¼‰ã€‚

ä»–ä»¬çš„åŒºåˆ«åœ¨äºï¼š

- Static Generationï¼šåœ¨ build æ—¶ç”Ÿæˆæ‰€æœ‰ HTML é¡µé¢ã€‚

  ![img](https://nextjs.org/static/images/learn/data-fetching/static-generation.png)

- Server-side Renderingï¼šåœ¨å‰ç«¯é¡µé¢è¯·æ±‚æ—¶æ‰ç”Ÿæˆå¯¹åº”çš„ HTML é¡µé¢ã€‚

![img](https://nextjs.org/static/images/learn/data-fetching/server-side-rendering.png)

åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šé¢„å‘ˆç°é¡µé¢ã€‚è¿™ä¹Ÿé€‚ç”¨äºé™æ€ç”Ÿæˆï¼Œä½¿å…¶æ›´æ˜“äºå¼€å‘ã€‚åœ¨æŠ•å…¥ç”Ÿäº§æ—¶ï¼Œé™æ€ç”Ÿæˆå°†åœ¨æ„å»ºæ—¶å‘ç”Ÿä¸€æ¬¡ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½å‘ç”Ÿã€‚

**é€‰æ‹© SSG è¿˜æ˜¯ SSRï¼Ÿ**

Next.js èƒ½å¤Ÿè®©ç”¨æˆ·é€‰æ‹©è¯¥é¡µé¢ä¸‹åˆ°åº•æ˜¯ç”¨ SSG è¿˜æ˜¯ SSRï¼Œæˆ‘ä»¬å¯ä»¥æ··åˆä½¿ç”¨ SSG æˆ–è€… SSRã€‚

![img](https://nextjs.org/static/images/learn/data-fetching/per-page-basis.png)

æ¨èå°½å¯èƒ½åœ°ä½¿ç”¨ SSG æ¨¡å¼å› ä¸ºé¡µé¢èƒ½å¤Ÿåªè¢«æ„å»ºä¸€æ¬¡ç„¶åè¢«ä¿å­˜åˆ° CDN ä¸­ï¼Œè¿™æ ·èƒ½è®©é¡µé¢åœ¨è¯·æ±‚ä¸‹å˜å¾—æ›´å¿«ã€‚

å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·è¯·æ±‚å‰å°±æŠŠé¡µé¢å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ SSGã€‚

å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç”¨æˆ·è¯·æ±‚å‰æˆ‘ä»¬æ²¡åŠæ³•æŠŠå†…å®¹å‡†å¤‡å¥½çš„è¯ï¼Œé‚£ä¹ˆå°±åªèƒ½ä½¿ç”¨ SSRã€‚

SSR ä¼šæ…¢ä¸€ç‚¹ï¼Œä½†é¢„æ¸²æŸ“çš„é¡µé¢å°†å§‹ç»ˆæ˜¯æœ€æ–°çš„ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥è·³è¿‡é¢„æ¸²æŸ“ï¼Œä½¿ç”¨å®¢æˆ·ç«¯ JavaScript æ¥å¡«å……é¢‘ç¹æ›´æ–°çš„æ•°æ®ã€‚

## fetching data

ä¸ç®¡æ˜¯ SSG è¿˜æ˜¯ SSRï¼Œéƒ½éœ€è¦æ•°æ®æ¥é¡µé¢å†…å®¹ã€‚å‰é¢è¯´äº† SSG åœ¨æ„å»ºæ—¶æŠŠ HTML é¡µé¢ç»™æ‰“åŒ…å¥½ï¼ŒSSR æ˜¯åœ¨ç”¨æˆ·è¯·æ±‚æ—¶æ‰æŠŠé¡µé¢ç”Ÿæˆå‡ºæ¥ç„¶åå‘ˆç°ç»™ç”¨æˆ·ï¼Œæ‰€ä»¥ä¸¤è€…ä¹‹é—´å¤„ç†æ•°æ®çš„æ–¹å¼è‚¯å®šä¹Ÿä¸åŒï¼š

- SSG å°†æ•°æ®æå‰æ‰“åŒ…åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œbuild çš„é¡µé¢ä¼šæ‰§è¡Œ JavaScript ä»æ–‡ä»¶ç³»ç»Ÿä¸­è·å–æ•°æ®ã€‚
- SSR æ˜¯åŠ¨æ€æ•°æ®ï¼Œéœ€è¦åœ¨ç”Ÿæˆé¡µé¢å‰ä»æ•°æ®åº“è·å–å¥½æ•°æ®ï¼Œç„¶åå¡åˆ°ç”Ÿæˆçš„é¡µé¢ä¸­ã€‚

### getStaticProps

åœ¨å¯¼å‡ºä¸€ä¸ª page ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŒæ ·å¯¼å‡ºä¸€ä¸ª`async`å‡½æ•°åå­—å«`getStaticProps`ã€‚

- `getStaticProps`ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒæ„å»ºæ—¶æ‰§è¡Œ
- åœ¨å‡½æ•°é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥è·å–é¢å¤–çš„æ•°æ®å¹¶ä¸”æŠŠå®ƒä½œä¸º props å‘é€ç»™ page

```js
export default function Home(props) { ... }

export async function getStaticProps() {
  // Get external data from the file system, API, DB, etc.
  const data = ...

  // The value of the `props` key will be
  //  passed to the `Home` component
  return {
    props: ...
  }
}
```

> `getStaticProps`å‡½æ•°ç›¸å½“äºæˆ‘ä»¬å‘Šè¯‰ Nextjsï¼šé¢„æ¸²æŸ“è¯¥é¡µé¢æ—¶ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…å‰è°ƒç”¨è¯¥æ–¹æ³•è·å–é¢å¤–çš„æ•°æ®ã€‚

`getStaticProps`ä»…åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä½†å¯ä»¥ä»æ–‡ä»¶ç³»ç»Ÿä¸­è·å–æ•°æ®ï¼Œè¿˜å¯ä»¥ä»æ•°æ®åº“ã€API ç­‰åœ°æ–¹è·å–æ•°æ®ã€‚

```js
export async function getSortedPostsData() {
  // Instead of the file system,
  // fetch post data from an external API endpoint
  const res = await fetch('..')
  return res.json()
}
```

```js
import someDatabaseSDK from 'someDatabaseSDK'

const databaseClient = someDatabaseSDK.createClient(...)

export async function getSortedPostsData() {
  // Instead of the file system,
  // fetch post data from a database
  return databaseClient.query('SELECT posts...')
}
```

ç”±äº SSG åœ¨æ„å»ºæ—¶ä»…å‘ç”Ÿä¸€æ¬¡ï¼Œå› æ­¤å®ƒä¸é€‚åˆé¢‘ç¹æ›´æ–°æˆ–è€…æ ¹æ®æ¯ä¸ªç”¨æˆ·è¯·æ±‚ä¸åŒçš„æ•°æ®ã€‚

å¦‚æœæ•°æ®é¢‘ç¹å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ SSRã€‚

### getServerSideProps

å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨ç”¨æˆ·è¯·æ±‚æ—¶è·å–æ•°æ®ï¼Œé‚£ä¹ˆå°±å¾—ç”¨`Server-side Rendering`ã€‚

ä»…éœ€åœ¨ page é¡µé¢ä¸­ä½¿ç”¨`getServerSideProps`å³å¯ï¼š

```js
export async function getServerSideProps(context) {
  return {
    props: {
      // props for your component
    },
  }
}
```

ç”±äº`getServerSideProps`å‡½æ•°ä¼šåœ¨è¯·æ±‚æ—¶æ‰§è¡Œï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ª`context`å‚æ•°åŒ…å«è¯·æ±‚çš„æè¿°å‚æ•°ã€‚

åªæœ‰åœ¨éœ€è¦é¢„å‘ˆç°å¿…é¡»åœ¨è¯·æ±‚æ—¶æå–æ•°æ®çš„é¡µé¢æ—¶ï¼Œæ‰åº”ä½¿ç”¨ getServerSidePropsã€‚

å½“ç„¶ï¼Œå¦‚æœå¯¹ SEO è¦æ±‚æ²¡é‚£ä¹ˆé«˜çš„è¯ï¼Œå°±å¯ä»¥ä½¿ç”¨`Client-side Rendering`ï¼Œé¡µé¢åŠ è½½å®Œæˆåæ‰å‘é€è¯·æ±‚ã€‚

### SWR

Next.js èƒŒåçš„å›¢é˜Ÿåˆ›å»ºäº†ä¸€ä¸ªå« [SWR](https://github.com/vercel/swr) çš„åº“æ¥å¸®åŠ©è¯·æ±‚æ•°æ®ï¼Œå¯ä»¥ç”¨æ¥åœ¨å®¢æˆ·ç«¯æ¸²æŸ“æ—¶è·å–æ•°æ®ï¼Œå®ƒä¼šå¤„ç†ç¼“å­˜ã€é—´éš”é‡æ–°è§¦å‘ç­‰åŠŸèƒ½ã€‚

```js
import useSWR from 'swr'

function Profile() {
  const { data, error } = useSWR('/api/user', fetch)

  if (error) return <div>failed to load</div>
  if (!data) return <div>loading...</div>
  return <div>hello {data.name}!</div>
}
```

## Dynamic Routes

### getStaticPaths

å¦‚æœä¸€ä¸ªé¡µé¢ä½¿ç”¨åŠ¨æ€è·¯ç”±ï¼Œå¹¶ä¸”ä½¿ç”¨`getStaticProps`,éœ€è¦ç”¨åˆ°`getStaticPaths`è¿™ä¸ªæ–¹æ³•ã€‚

> è·Ÿ`getStaticProps`ä¸€æ ·ï¼Œ`getStaticPaths`ä¹Ÿåªèƒ½åœ¨æ„å»ºæ—¶æ‰§è¡Œä¸€æ¬¡ã€‚

è¯¥æ–¹æ³•å¯ä»¥å¤„ç†é™æ€çš„è·¯å¾„ï¼Œå¹¶ä¸”å°†æŸäº›å‚æ•°ä¼ é€’ç»™`getStaticProps`ã€‚

`getStaticPaths`å†…å¯ä»¥å¤„ç†ï¼š

- æ•°æ®åº“æ•°æ®
- æ–‡ä»¶ç³»ç»Ÿ
- ...

ä»¥æ–‡ä»¶ç³»ç»Ÿä¸ºä¾‹ï¼Œåœ¨ pages ç›®å½•ä¸‹å»º`[id].tsx`æ–‡ä»¶ï¼Œå¹¶ä¸”åˆ›å»ºä¸‰ä¸ªæ–¹æ³•ï¼š

```js
import Layout from '../../components/layout'

export default function Post() {
  return <Layout>...</Layout>
}

export async function getStaticPaths() {
  // Return a list of possible value for id
}

export async function getStaticProps({ params }) {
  // Fetch necessary data for the blog post using params.id
}
```

åœ¨ `getStaticPaths`ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è·å–æ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„ï¼Œä¾‹å¦‚åœ¨`src/docs`ä¸‹ï¼Œåˆ†åˆ«æ”¾äº†ä¸¤ä¸ª`md`æ–‡ä»¶(å†…å®¹éšæ„)ã€‚

ç„¶åå°±ç”¨`fs.readdirSync`æ–¹æ³•æ¥è·å–è¿™ä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶,è¿™é‡Œå°†å¤„ç†é€»è¾‘æ”¾åœ¨`getAllPostIds`é‡Œã€‚

```js
export function getAllPostIds() {
  const fileNames = fs.readdirSync(postsDirectory)
  console.log('ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ - file: posts.ts:10 - getAllPostIds - fileNames:', fileNames)
  // Returns an array that looks like this:
  // [
  //   {
  //     params: {
  //       id: 'æ–‡ä»¶ a'
  //     }
  //   },
  //   {
  //     params: {
  //       id: 'æ–‡ä»¶ b'
  //     }
  //   }
  // ]
  return fileNames.map((fileName) => ({
    params: {
      id: fileName.replace(/\.md$/, ''),
    },
  }))
}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„è¿”å›å€¼éœ€è¦æ˜¯ä¸€ä¸ªå¯¹è±¡çš„æ•°ç»„ã€‚

æ¥ç€å°†`getAllPostIds`æ”¾åˆ°`getStaticPaths`ä¸­ã€‚

```js
export async function getStaticPaths() {
  // Return a list of possible value for id
  const paths = getAllPostIds()
  return {
    paths,
    fallback: false,
  }
}
```

ä½¿ç”¨`getStaticPaths`è¿”å›ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯`paths`å’Œ`fallback`ã€‚

`nextjs`ä¼šéå† `paths`ï¼Œç„¶åå°†æ¯ä¸ªå¯¹è±¡é‡Œçš„å±æ€§ä¼ é€’ç»™`getStaticProps`ã€‚

ä¸‹é¢å¤„ç†`getStaticProps`çš„é€»è¾‘ï¼š

```js
export async function getStaticProps({ params }) {
  const postData = await getPostData(params.id)
  return {
    props: {
      postData,
    },
  }
}
```

`path`çš„ `params`å±æ€§å·²ç»é€ä¼ åˆ°`getStaticProps`ä¸­äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¤„ç†è·å–æ•°æ®çš„é€»è¾‘ã€‚

è¿™é‡Œçš„`getPostData`æ–¹æ³•æ˜¯æ‹·è´äº†å®˜æ–¹æ–‡æ¡£ä¸­çš„é€»è¾‘ï¼Œç”¨`remark`å’Œ`remark-html`æ¥å°† markdown æ•°æ®è§£ææˆ htmlã€‚

```js
const postsDirectory = path.join(process.cwd(), 'src', 'docs')

export async function getPostData(id: string) {
  const fullPath = path.join(postsDirectory, `${id}.md`)
  const fileContents = fs.readFileSync(fullPath, 'utf8')

  // Use gray-matter to parse the post metadata section
  const matterResult = matter(fileContents)

  // Use remark to convert markdown into HTML string
  const processedContent = await remark().use(html).process(matterResult.content)
  const contentHtml = processedContent.toString()

  // Combine the data with the id and contentHtml
  return {
    id,
    contentHtml,
    ...matterResult.data,
  }
}
```

æˆ‘ä»¬ä»åˆ›å»ºçš„ md æ–‡ä»¶ä¸­è·å–åˆ°äº† idï¼ˆå…¶å®å°±æ˜¯æ–‡ä»¶åï¼‰ä»¥åŠ è§£æåçš„ HTMLã€‚

å†é€šè¿‡`getStaticProps`å°†æ•°æ®ä¼ é€’ç»™ page ç»„ä»¶

```jsx | pure
export default function Post({ postData }) {
  return (
    <div>
      {postData.title}
      <br />
      <div dangerouslySetInnerHTML={{ __html: postData.contentHtml }} />
    </div>
  )
}
```

åŠ¨æ€è·¯ç”±å°±å®Œæˆäº†ã€‚

### Fallback

åœ¨`getStaticPaths`ä¸­ï¼Œæˆ‘ä»¬è¿”å›äº†ä¸¤ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯`paths`å’Œ`fallback`ï¼Œfallback å¯ä»¥æœ‰ä¸‰ä¸ªå€¼ï¼š

- falseï¼šåªä¼šåœ¨ build çš„æ—¶å€™æ„å»ºåˆ¶å®šçš„é¡µé¢ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™ 404

- trueï¼šè®¿é—®æ²¡æœ‰å®šä¹‰çš„é¡µé¢æ—¶ä¸ä¼šè¿”å› 404ï¼Œä½†ä¼šä¼ é€’ä¸€ä¸ª`isFallback`çŠ¶æ€ç»™è·¯ç”±é¡µé¢ï¼Œå¹¶ä¸”åœ¨æœåŠ¡å™¨ä¸­å†è°ƒç”¨ä¸€æ¬¡`getStaticProps`æ–¹æ³•ï¼Œå®Œæˆåï¼Œæµè§ˆå™¨ä¼šæ”¶åˆ°`JSON`ç”Ÿæˆçš„æ•°æ®å¹¶æ¸²æŸ“å‡º`fallback`é¡µé¢ã€‚

  åŒæ—¶ï¼ŒNext.js å°†æ­¤è·¯å¾„ç¼“å­˜åˆ°é¢„æ¸²æŸ“é¡µé¢åˆ—è¡¨ä¸­ï¼Œå¯¹åŒä¸€è·¯å¾„çš„åç»­è¯·æ±‚å°†æä¾›ç¬¬ä¸€æ¬¡ç”Ÿæˆçš„é¡µé¢ï¼Œå°±åƒåœ¨æ„å»ºæ—¶é¢„å‘ˆç°çš„å…¶ä»–é¡µé¢ä¸€æ ·ã€‚

  ```js
  export default function Post({ postData }) {
    const router = useRouter()
    if (router.isFallback) {
      return <div>Loading...</div>
    }
    return (
      <div>
        {postData?.title}
        <br />
        <div dangerouslySetInnerHTML={{ __html: postData?.contentHtml }} />
      </div>
    )
  }

  export async function getStaticProps({ params }) {
    // { params:'c' }
    let postData
    try {
      postData = await getPostData(params?.id)
    } catch (error) {
      postData = { title: 'error' }
    }

    return {
      props: {
        postData,
      },
    }
  }
  ```

  ä¸Šé¢ç¤ºä¾‹ä»£ç ä¸­ï¼Œå¦‚æœåœ¨å‰ç«¯é¡µé¢è®¿é—®`/posts/c`æ—¶ï¼Œç”±äºæ²¡æœ‰ `c.md`è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚

  ä¸Šé¢ä½¿ç”¨ä¸€ä¸ªé”™è¯¯å¤„ç†å¯¹è¿™ç§æƒ…å†µè¿›è¡Œé™çº§ã€‚

  åœ¨`getStaticProps`è¯·æ±‚å®Œæˆä¹‹å‰ï¼Œé¡µé¢ä¸­æ‹¿åˆ°çš„`isFallback = true`,æ•…è€Œä¼šæœ‰ä¸€ä¸ª `loading`çš„æ•ˆæœã€‚

- blockï¼šè®¿é—®æ²¡æœ‰å®šä¹‰çš„é¡µé¢æ—¶ä¸ä¼šè¿”å› 404ï¼Œä¹Ÿä¸ä¼šä¼ é€’ `isFallback`ç»™è·¯ç”±é¡µé¢ã€‚ä½†ä¼šå°†é¡µé¢ç”Ÿæˆ SSR å¹¶è¿”å›ï¼Œè¿™ç§æ–¹å¼å¯èƒ½æœ‰ç‚¹æ…¢ï¼Œä½†æ˜¯ä¹Ÿåªç”Ÿæˆä¸€æ¬¡ï¼Œç”Ÿæˆå®Œåä¼šç¼“å­˜åˆ°é¢„æ¸²æŸ“åˆ—è¡¨ä¸­ã€‚

### all Routes

æŠŠ`...`ç¬¦å·æ·»åŠ åˆ°`[]`é‡Œï¼Œå°±å¯ä»¥æ•è·æ‰€æœ‰çš„è·¯ç”±ã€‚

`pages/posts/[...id].js`å¯ä»¥è¢«`/posts/a`ã€`/posts/a/b`ä»¥åŠ`/posts/a/b/c`ç­‰æ•è·ã€‚

å¦‚æœè¦è¿™ä¹ˆåšçš„è¯ï¼Œå°±éœ€è¦åœ¨`getStaticPaths`ä¸­è¿”å›ä¸€ä¸ªæ•°ç»„ï¼š

```js
return [
  {
    params: {
      // Statically Generates /posts/a/b/c
      id: ['a', 'b', 'c'],
    },
  },
  //...
]
```

åœ¨`getStaticProps`ä¸­è·å–çš„æ•°æ®æ˜¯è¿™æ ·çš„

```js
export async function getStaticProps({ params }) {
  // params.id will be like ['a', 'b', 'c']
}
```

### 404 é¡µé¢

é»˜è®¤æƒ…å†µä¸‹ï¼ŒNextjs ä¼šæä¾› 404 é¡µé¢ï¼Œå¦‚æœæƒ³è¦è‡ªå®šä¹‰åˆ™éœ€è¦åœ¨ page ä¸­æ‰‹åŠ¨åˆ›å»ºã€‚

```jsx | pure
// pages/404.js
export default function Custom404() {
  return <h1>404 - Page Not Found</h1>
}
```

## API è·¯ç”±

### ç¤ºä¾‹

`pages/api`æ–‡ä»¶å¤¹ç”¨æ¥å¤„ç† API è·¯ç”±çš„ï¼Œåœ¨é‡Œé¢çš„æ–‡ä»¶ä»¥åŠå‡½æ•°èƒ½å¤Ÿè¢«éƒ¨ç½²æˆç±»ä¼¼äº Serverless çš„ functionï¼Œç±»ä¼¼äº`Lambdas`ã€‚

ä»¥ä¸‹æ˜¯ç¤ºä¾‹ã€‚

```ts
// pages/api/hello
import type { NextApiRequest, NextApiResponse } from 'next'

type Data = {
  text: string
}

export default function handler(req: NextApiRequest, res: NextApiResponse<Data>) {
  res.status(200).json({ text: 'Hello' })
}
```

å½“å‰ç«¯è¯·æ±‚`/api/hello`æ—¶ï¼Œå¯ä»¥å¾—åˆ°`{ text: 'Hello' }`

### ä½¿ç”¨è§„åˆ™

ä¸è¦åœ¨`getStaticProps`æˆ–è€…`getStaticPaths`ä¸­ä½¿ç”¨ API è·¯ç”±ã€‚

å› ä¸ºè¿™ä¸¤ä¸ªå‡½æ•°åªä¼šåœ¨ server ç«¯è¿è¡Œè€Œä¸ä¼šåœ¨æµè§ˆå™¨ç«¯è¿è¡Œï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šå­˜åœ¨äºæµè§ˆå™¨`JS bundle` ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ç›´æ¥åœ¨é‡Œé¢åšæ•°æ®åº“æŸ¥è¯¢æ“ä½œã€‚

ä¸€ä¸ªå¥½çš„ä½¿ç”¨ä¾‹å­æ˜¯å¤„ç† form è¡¨å•è¾“å…¥ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨å‰ç«¯é¡µé¢åˆ›å»ºè¡¨å•è¾“å…¥æ¡†ï¼Œç„¶åæŠŠå†…å®¹`post`åˆ° API è·¯ç”±ä¸­ï¼Œç”±äº API è·¯ç”±ä¸ä¼šæ‰“åŒ…åˆ°å‰ç«¯çš„`bundle`ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™ä¸€äº›æ•°æ®åº“æ“ä½œï¼ŒæŠŠæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“é‡Œã€‚

```js
export default function handler(req, res) {
  const email = req.body.email
  // Then save email to your database, etc...
}
```
