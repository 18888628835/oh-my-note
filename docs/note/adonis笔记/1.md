# AdonisJS at a glance

æœ¬ç« èŠ‚æ—¨åœ¨ç»™å‡ºæ¡†æ¶çš„é¸Ÿç°è§†è§’ï¼Œè®©ä½ å¯¹åˆ›å»º `AdonisJS` åº”ç”¨æœ‰ä¸€ä¸ªåˆæ­¥çš„äº†è§£ã€‚

å½“ä½ å‡†å¤‡å¥½å»å†™é¡¹ç›®æ—¶ï¼Œå¯ä»¥ç›´æ¥[è¿›å…¥æŠ€æœ¯æŒ‡å—](https://docs.adonisjs.com/guides/introduction)ã€‚

`AdonisJS`æ˜¯ä¸€ä¸ªåç«¯æ¡†æ¶ã€‚å®ƒèƒ½å¸®åŠ©ä½ åˆ›å»ºä»¥æ•°æ®é©±åŠ¨çš„åŠ¨æ€ Web åº”ç”¨ã€‚

ä½¿ç”¨`AdonisJS`ï¼Œä½ å¯ä»¥å¤„ç† HTTP è¯·æ±‚ã€æŸ¥è¯¢æ•°æ®åº“ã€ç”¨æˆ·éªŒè¯ã€ä¸Šä¼ æ–‡ä»¶ã€å‘é€ Email ç­‰å†…å®¹ã€‚

å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡å…¶ä»–åç«¯æ¡†æ¶æ¯”å¦‚`Rails`ã€`Laravel`æˆ–`Django`,ä½ å°±å¯ä»¥æŠŠ `AdonisJS` çœ‹æˆæ˜¯åŒä¸€ç±»çš„æ¡†æ¶ã€‚

## ç”¨ routes åˆ›å»ºè·¯ç”±

ä½ èƒ½ä½¿ç”¨ routes ï¼ˆå³è·¯ç”±ï¼‰æ¨¡å—å®šä¹‰ URLã€‚

ä½ å¯ä»¥æŠŠ routes çœ‹æˆæ˜¯ URL å’Œ JavaScript å‡½æ•°é—´çš„æ˜ å°„ï¼Œå½“ç”¨æˆ·è®¿é—®è¯¥ URL æ—¶ï¼Œå°±èƒ½æ‰§è¡Œè·¯ç”±ä¸Šçš„ JavaScriptã€‚

```js
import Route from '@ioc:Adonis/Core/Route'

Route.get('/', () => {
  return 'Hello! This is the homepage of my new app'
})
```

ä¸Šé¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªé™æ€çš„è·¯ç”±ã€‚ç„¶è€Œï¼Œæ•°æ®é©±åŠ¨çš„åº”ç”¨å¾€å¾€éœ€è¦ä¸€ç§èƒ½æ³¨å†ŒåŠ¨æ€è·¯ç”±çš„èƒ½åŠ›ã€‚ä¸¾ä¸ªä¾‹å­ï¼šåˆ©ç”¨ URL ä¸Šçš„ id æ¥æŸ¥è¯¢æ•°æ®åº“ã€‚

```js
import Route from '@ioc:Adonis/Core/Route'
import Database from '@ioc:Adonis/Lucid/Database'

Route.get('posts/:id', ({ params }) => {
  return Database.from('posts').select('*').where('id', params.id).first()
})
```

## ç”¨ Controller å¤„ç†è¯·æ±‚

åœ¨ AdonisJS ä¸­ï¼ŒControllerï¼ˆæ§åˆ¶å™¨ï¼‰æ˜¯ä¸€ç§å¤„ç†ç½‘ç»œè¯·æ±‚çš„äº‹å®æ ‡å‡†æ–¹æ³•ï¼Œå®ƒä»¬å¸®åŠ©æ‚¨ä»è·¯ç”±æ–‡ä»¶ä¸­æå–æ‰€æœ‰å†…è”å‡½æ•°è°ƒç”¨åˆ°ä¸“ç”¨çš„æ§åˆ¶å™¨æ–‡ä»¶ä¸­ï¼Œå¹¶ä¿æŒæ‚¨çš„è·¯ç”±æ–‡ä»¶æ•´æ´ã€‚

ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ§åˆ¶å™¨

```bash
node ace make:controller Posts
```

ç¬¬äºŒæ­¥ï¼šå®ç°æ‰€éœ€è¦çš„è¯·æ±‚å¤„ç†æ–¹æ³•

```js
  import Database from '@ioc:Adonis/Lucid/Database'

  export default class PostsController {
    public async show({ params }) {
      return Database
        .from('posts')
        .select('*')
        .where('id', params.id)
        .first()
    }
  }
```

ç¬¬ä¸‰æ­¥ï¼šåœ¨è·¯ç”±ä¸Šæ³¨å†Œ

```js
Route.get('posts/:id', 'PostsController.show')
```

## ç”¨ ORM æŸ¥è¯¢æ•°æ®åº“

ä½ èƒ½ä½¿ç”¨å®˜æ–¹çš„ ORM åº“- Lucid æ¥ä¸ SQL æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚Lucid å…·æœ‰ä¸°å¯Œçš„ APIï¼Œå¯æ‰§è¡Œæ¨¡å¼è¿ç§»ã€ä½¿ç”¨ JavaScript API æ„å»º SQL æŸ¥è¯¢ä»¥åŠä¸ºæ•°æ®åº“æ·»åŠ è™šæ‹Ÿæ•°æ®ã€‚

æ›´é‡è¦çš„æ˜¯ï¼ŒLucid åœ¨æ´»åŠ¨è®°å½•æ¨¡å¼çš„åŸºç¡€ä¸Šæ„å»ºäº†æ•°æ®æ¨¡å‹ã€‚æ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼åˆ›å»ºå’Œä½¿ç”¨æ¨¡å‹ï¼š

1. åˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹

   ```bash
   node ace make:model Post
   ```

2. é…ç½®åˆ—ä¿¡æ¯

   ```js
     import { column, BaseModel } from '@ioc:Adonis/Lucid/Orm'

     export default class Post extends BaseModel {
       @column({ isPrimary: true })
       public id: number

       @column()
       public title: string

       @column()
       public description: string
     }
   ```

3. åœ¨æ§åˆ¶å™¨ä¸­å¼•å…¥å¹¶ä½¿ç”¨å®ƒä»¬

   ```js
     import Post from 'App/Models/Post'

     export default class PostsController {
       public async show({ params }) {
         const post = await Post.find(1)
         return post
       }
     }
   ```

## ç”¨ templates æ¸²æŸ“ HTML

AdonisJS é™„å¸¦ä¸€ä¸ªè‡ªä¸»å¼€å‘çš„æ¨¡ç‰ˆå¼•æ“â€”â€”`Edge`.`Edge`æ”¯æŒå¸ƒå±€ã€éƒ¨åˆ†æ¸²æŸ“ã€æ¡ä»¶è¯­å¥ã€å¾ªç¯ç­‰ã€‚ä½†æœ€è€€çœ¼çš„æ˜¯ edge çš„ç»„ä»¶ç³»ç»Ÿã€‚

1. åˆ›å»º View æ¨¡æ¿

   ```bash
     node ace make:view posts/index
   ```

2. ä¹¦å†™æ ‡è®°

   ```html
   <div class="article">
     <h1>{{ post.title }}</h1>
     <p>{{ post.description }}</p>
   </div>
   ```

3. åœ¨æ§åˆ¶å™¨ä¸­æ¸²æŸ“æ¨¡æ¿

   ```js
     import Post from 'App/Models/Post'

     export default class PostsController {
       public async show({ params, view }) {
         const post = await Post.find(1)
         return view.render('posts/index', { post })
       }
     }
   ```

## ç”¨ auth package é‰´æƒ

AdonisJS æ”¯æŒå„ç§èº«ä»½é‰´æƒç³»ç»Ÿï¼Œæ»¡è¶³ä¼ ç»Ÿçš„ Web App å’Œ API Servers çš„éœ€è¦ã€‚åœ¨é‰´æƒå®ˆå«ï¼ˆguardï¼‰çš„å¸®åŠ©ä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åŸºäº sessionï¼ˆä¼šè¯ï¼‰çš„ç™»å½•æˆ–åˆ›å»ºç”¨äºæ— çŠ¶æ€èº«ä»½éªŒè¯çš„ API ä»¤ç‰Œã€‚

1. æŒ‰ç…§å’Œè®¾ç½® auth package

   ```bash
     npm i @adonisjs/auth

     node ace configure @adonisjs/auth
   ```

2. ä½¿ç”¨ session ç™»å½•

   ```js
     export default class AuthController {
       public async login({ request, auth, response }) {
         const email = request.input('email')
         const password = request.input('password')

         await auth
           .use('web') // ğŸ‘ˆ using sessions guard
           .attempt(email, password)

         response.redirect().toRoute('dashboard')
       }
     }
   ```

3. æˆ–è€…ç”Ÿæˆ API ä»¤ç‰Œï¼ˆTokenï¼‰æ›¿ä»£ session

   ```js
     export default class AuthController {
       public async login({ request, auth }) {
         const email = request.input('email')
         const password = request.input('password')

         const token = await auth
           .use('api') // ğŸ‘ˆ using API guard
           .attempt(email, password)

         return token
       }
     }
   ```

## ç”¨ validator æ ¡éªŒ

å°† validators ä½œä¸ºç¬¬ä¸€é“é˜²çº¿ä»¥ä¿æŠ¤åº”ç”¨ä¸å—æ— æ•ˆæ•°æ®æˆ–è€…ç¼ºå¤±æ•°æ®çš„å½±å“ã€‚

æœªèƒ½æ»¡è¶³éªŒè¯è§„åˆ™çš„è¯·æ±‚å°†è¢«é‡å®šå‘å›è¡¨å•ï¼Œå¹¶æ˜¾ç¤ºæ­£ç¡®çš„é”™è¯¯æ¶ˆæ¯ã€‚åä¹‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­£ç¡®çš„æ•°æ®ç±»å‹è®¿é—®å·²éªŒè¯çš„å€¼ã€‚

1. åˆ›å»º validator

   ```bash
     node ace make:validator CreatePost
   ```

2. å®šä¹‰ validation schema

   ```js
     import { schema, rules } from '@ioc:Adonis/Core/Validator'
     import { HttpContextContract } from '@ioc:Adonis/Core/HttpContext'

     export default class CreatePostValidator {
       constructor (protected ctx: HttpContextContract) {
       }

       public schema = schema.create({
         title: schema.string(),
         description: schema.string({}, [
           rules.escape()
         ]),
       })
     }
   ```

3. éªŒè¯è¯·æ±‚

   ```js
     import CreatePost from 'App/Validators/CreatePostValidator'

     export default class PostsController {
       public async store({ request }) {
         const post = await request.validate(CreatePost)
         console.log(post.title)
         console.log(post.description)
       }
     }
   ```

## ç”¨ webpack encore ç¼–è¯‘èµ„æº

åœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ CSS æ¡†æ¶å¹¶å¸Œæœ›æ·»åŠ ä¸€äº› JavaScript ä½¿ä½ çš„ Web åº”ç”¨ç¨‹åºå…·æœ‰äº¤äº’æ€§ã€‚

æ ¹æ®ä»Šå¤©çš„æ ‡å‡†ï¼ŒCSS å’Œå‰ç«¯ JavaScript åœ¨ä¼ è¾“åˆ°æµè§ˆå™¨ä¹‹å‰éœ€è¦è¿›è¡Œè½¬è¯‘å’Œå‹ç¼©ã€‚è¿™ä¸ªæ‰“åŒ…è¿‡ç¨‹å¹¶ä¸ç®€å•ï¼Œå› æ­¤ä½ å¿…é¡»ä½¿ç”¨æ‰“åŒ…å·¥å…·ã€‚

AdonisJS ä½¿ç”¨åˆç†çš„é»˜è®¤è®¾ç½®é¢„é…ç½®äº† Webpackï¼ˆä¸€ä¸ªè¡Œä¸šæ ‡å‡†çš„æ‰“åŒ…å·¥å…·ï¼‰ï¼Œè¿™æ ·ä½ å°±ä¸å¿…æµªè´¹æ—¶é—´è°ƒæ•´å®ƒçš„å‚æ•°ã€‚

1. é…ç½® webpack encore

   ```bash
     node ace configure encore
   ```

2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

   ```bash
     node ace serve --watch

     # Serve command starts both
     # âœ… The AdonisJS HTTP server
     # âœ… And the Webpack dev server
   ```

3. æ„å»ºç”Ÿäº§ç¯å¢ƒ

   ```bash
     node ace build --production

     # Build commands compile both
     # âœ… The AdonisJS Typescript source to JavaScript
     # âœ… And the frontend assets using Webpack
   ```
