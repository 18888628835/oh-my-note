# Service Provider

adonisJS è¦å®ç° Controller å’Œ Service çš„åˆ†ç¦»ï¼Œè¿™é‡Œç”¨åˆ° Service Providerã€‚

1. å°† Provider æ³¨å…¥åˆ° adonis ä¸­

   ```bash
   touch providers/ServiceProvider.ts
   ```

   åœ¨é…ç½®æ–‡ä»¶`.adonisrc.json`ä¸­æ³¨å…¥è¿™ä¸ª Providerã€‚

   ```js
     "providers": [
       "./providers/ServiceProvider",
       ...
     ]
   ```

2. åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ç”¨ä¸€ä¸ª class implement å®ƒï¼Œè¿™ä¸ª class é‡Œå†™ service ä»£ç 

   ```bash
   touch Service/Login.ts
   ```

   ```js
   export interface Login_Interface {
     signup: () => Promise<any>;
   }

   export default class Login implements Login_Interface {
     public database;
     constructor(database: typeof Database) {
       this.database = database;
     }
     public async signup() {
     	...
     }
   }
   ```

   æ³¨æ„ï¼šç”±äºæ³¨å…¥çš„ Service çš„å®ä¾‹æ–¹æ³•ä¸­ä¸èƒ½ç›´æ¥ä½¿ç”¨`import Database from @ioc:Adonis/Lucid/Database`,æ‰€ä»¥è¿™é‡Œåœ¨ constructor æ—¶ä¼ é€’ database è¿‡å»ã€‚

3. åœ¨ ServiceProvider ä¸­æ³¨å†Œ Service

   ```js
   import { ApplicationContract } from "@ioc:Adonis/Core/Application";
   import Login from "../Service/Login";

   export default class ServiceProvider {
     constructor(protected app: ApplicationContract) {}
     public register() {
       this.app.container.singleton("Loc/Signup", () => {
         const database = this.app.container.use("Adonis/Lucid/Database");
         return new Login(database);
       });
     }
     public async boot() {
       // IoC container is ready
     }

     public async ready() {
       // App is ready
     }

     public async shutdown() {
       // Cleanup, since app is going down
     }
   }
   ```

   è¿™ä¸ª Provider çš„æ³¨å†Œå‘¨æœŸå†…ï¼Œç”¨å•ä¾‹æ¨¡å¼æ³¨å†Œä¸€ä¸ª Login å®ä¾‹ã€‚

   ç”±äº Provider ä¸­ä¹Ÿä¸èƒ½ç›´æ¥å¼•å…¥`Database`ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨`this.app.container.use("Adonis/Lucid/Database")`å°† database å¯¹è±¡ä¼ é€’è¿‡å»ï¼Œè¿™é‡Œå°±æ¥ä¸Šäº†ç¬¬ä¸€æ­¥ä¸­çš„`constructor`ã€‚

4. æš´éœ²å‡ºè¿™ä¸ªå®ä¾‹çš„æ–¹æ³•

   ```bash
   touch contracts/login.ts
   ```

   ```js
   declare module "@ioc:Loc/Signup" {
     import { Login_Interface } from "Service/Login";
     const login: Login_Interface;
     export default login;
   }
   ```

   è¿™æ ·åœ¨ Typescript ä¸‹ï¼Œå°±ä¼šæœ‰è¯­æ³•æç¤ºã€‚

5. Controller ä¸­è°ƒç”¨ Service çš„ä»£ç 

   ```js
   import loginInstance from "@ioc:Loc/Signup";

   export default class LoginController {
     public async signup() {
       return loginInstance.signup();
     }
     ...
   }
   ```

6. è¡¥å…… service æ–¹æ³•ï¼Œè¿™é‡Œçš„ç¤ºä¾‹æ˜¯è°ƒç”¨æ•°æ®åº“æŸ¥è¯¢

   ```js
     public async signup() {
       const { default: Users } = await import("App/Models/User");
       const dbRes = await this.database.from("users").where("user", "é‚±å½¦å…®");
       const ormRes = await Users.query().select("*").where("user", "é‚±å½¦å…®");
       console.log("ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ - res:", [...dbRes, ...ormRes]);
       return [...dbRes, ...ormRes];
     }
   ```

   åœ¨ service ä¸­ï¼Œä¸ç®¡æ˜¯ç”¨ database è¿˜æ˜¯ orm éƒ½ä¸èƒ½ç›´æ¥`import xxx from xxx`ã€‚

   è¿™é‡Œçš„ç»†èŠ‚åœ¨äºï¼š

   1. å–`constructor`åçš„ database å¯¹è±¡æ¥æŸ¥è¯¢æ•°æ®åº“
   2. ä½¿ç”¨`await import("App/Models/User")`è·å– orm ç‰ˆæœ¬çš„æ•°æ®åº“æŸ¥è¯¢å¯¹è±¡æ¥æŸ¥è¯¢æ•°æ®åº“

ç°åœ¨ä½ å·²ç»å®ç°äº† Controller å’Œ Service çš„åˆ†ç¦»ã€‚
