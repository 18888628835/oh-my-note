# Â¶Ç‰Ωï‰ΩøÁî® S3

Amazon S3 (Simple Storage Service) ÊòØ‰∏ÄÁßç‰∫ëÂ≠òÂÇ®ÊúçÂä°ÔºåÊèê‰æõ‰∫ÜÁÆÄÂçïÊòìÁî®ÁöÑ Web ÊúçÂä°Êé•Âè£Êù•Â≠òÂÇ®ÂíåÊ£ÄÁ¥¢‰ªªÊÑèÊï∞ÈáèÁöÑÊï∞ÊçÆ„ÄÇ

ÂÆÉÁöÑ‰∏ªË¶ÅÂäüËÉΩÊúâÔºö

1. Â≠òÂÇ®ÂíåÊ£ÄÁ¥¢Êï∞ÊçÆÔºöÊÇ®ÂèØ‰ª•‰∏ä‰º†‰ªªÊÑèÊï∞ÈáèÁöÑÊï∞ÊçÆÂà∞ S3ÔºåÂπ∂Âú®‰ªª‰ΩïÊó∂Èó¥‰ªé‰ªª‰ΩïÂú∞ÁÇπÊ£ÄÁ¥¢Ëøô‰∫õÊï∞ÊçÆ„ÄÇ
2. Êï∞ÊçÆÂ§á‰ªΩÂíåÊÅ¢Â§çÔºöS3 Êèê‰æõ‰∫ÜÈ´òÊåÅ‰πÖÊÄßÁöÑÂ≠òÂÇ®Ôºå‰ΩøÂÖ∂Êàê‰∏∫Â§á‰ªΩÂíåÊÅ¢Â§çÊï∞ÊçÆÁöÑÁêÜÊÉ≥ÈÄâÊã©„ÄÇ
3. ÈùôÊÄÅÁΩëÁ´ôÊâòÁÆ°ÔºöÊÇ®ÂèØ‰ª•‰ΩøÁî® S3 Êù•ÊâòÁÆ°ÈùôÊÄÅÁΩëÁ´ôÔºåÂåÖÊã¨ HTML„ÄÅCSS„ÄÅJavaScript Á≠âÊñá‰ª∂„ÄÇ
4. Êï∞ÊçÆÂΩíÊ°£ÔºöS3 Êèê‰æõ‰∫Ü‰∏ÄÁßçÂêç‰∏∫ Glacier ÁöÑ‰ΩéÊàêÊú¨Â≠òÂÇ®ÈÄâÈ°πÔºåÁî®‰∫éÈïøÊúüÂΩíÊ°£Êï∞ÊçÆ„ÄÇ
5. Â§ßÊï∞ÊçÆÂàÜÊûêÔºöS3 ÊòØÂ§ßÊï∞ÊçÆÂíåÂàÜÊûêÂ∑•‰ΩúË¥üËΩΩÁöÑÁêÜÊÉ≥Â≠òÂÇ®Ëß£ÂÜ≥ÊñπÊ°àÔºåÂõ†‰∏∫ÂÆÉÂèØ‰ª•Â≠òÂÇ®ÂíåÊ£ÄÁ¥¢Â§ßÈáèÁöÑÊï∞ÊçÆ
6. ÂÜÖÂÆπÂàÜÂèëÔºöS3 ÂèØ‰ª•‰∏é Amazon CloudFront ÈõÜÊàêÔºåÁî®‰∫éÂàÜÂèëÂÜÖÂÆπÔºàCDNÔºâ„ÄÇ

## ÂáÜÂ§áÂ∑•‰Ωú

1. ÂøÖÈ°ªÊã•Êúâ`Security Credentials`(ÂÆâÂÖ®Âá≠ËØÅ)„ÄÇ

   Ëé∑ÂèñÊñπÂºèÔºö

   - ÁôªÈôÜ AWS account

   - Âè≥‰∏äÊñπÁÇπÂáª‰Ω†ÁöÑË¥¶Êà∑ÂêçÔºåÈÄâÊã© ‚ÄúSecurity Credentials‚Äù

     ![image-20231220174431728](https://raw.githubusercontent.com/18888628835/image-cloud/main/assets202312201744678.png)

   - ÂàõÂª∫ Access Keys

     ![image-20231220174536680](https://raw.githubusercontent.com/18888628835/image-cloud/main/assets202312201745959.png)

2. Âú®È¶ñÈ°µÈÄâÊã©‰∏Ä‰∏™ regionÔºåÂπ∂ËÆ∞‰ΩèÂÆÉÁöÑÁºñÁ†Å

   ![image-20231220175503348](https://raw.githubusercontent.com/18888628835/image-cloud/main/assets202312201755455.png)

## ‰∏ä‰º†Êñá‰ª∂Ëá≥ S3

Âú®‰∏ä‰º†Êñá‰ª∂‰πãÂâçÔºåÈúÄË¶Å‰∏ãËΩΩËøô‰∏™ÂåÖÔºö

```bash
yarn add @aws-sdk/client-s3
```

ÂàõÂª∫‰∏Ä‰∏™ bucketÔºàÂ≠òÂÇ®Ê°∂ÔºâÔºå‰ª•‰æøÂàÜÁ±ª‰Ω†ÊÉ≥ÂÇ®Â≠òÁöÑÊï∞ÊçÆ„ÄÇ

```typescript
import { S3Client, CreateBucketCommand, CreateBucketCommandInput } from '@aws-sdk/client-s3'

const accessKeyId = 'YOUR_ACCESS_KEY'
const secretAccessKey = 'YOUR_ACCESS_KEY_SECRET'
const REGION = 'ap-northeast-1'
const BUCKET_NAME = 'bucket-1-2021-10-12'

// ÂàõÂª∫ S3 ÂÆ¢Êà∑Á´Ø
const s3Client = new S3Client({
  region: REGION,
  credentials: {
    accessKeyId,
    secretAccessKey,
  },
})

// ËÆæÁΩÆ bucket ÂèÇÊï∞
const bucketParams: CreateBucketCommandInput = {
  Bucket: BUCKET_NAME,
  CreateBucketConfiguration: {
    LocationConstraint: REGION,
  },
}

const run = async () => {
  try {
    const data = await s3Client.send(new CreateBucketCommand(bucketParams))
    console.log('Success', data)
  } catch (err) {
    console.log('Error', err)
  }
}

run()
```

ÂàóÂá∫ÊâÄÊúâ budgets ‰ª£Á†Å

```js
const listBucketParams: ListBucketsCommandInput = {}

const run = async () => {
  try {
    const data = await s3Client.send(new ListBucketsCommand(listBucketParams))
    console.log('Success', data)
  } catch (err) {
    console.log('Error', err)
  }
}

run()
```

‰∏äÈù¢ÁöÑ‰ª£Á†ÅÂèØ‰ª•Ëé∑Âæó‰ª•‰∏ãÁªìÊûú

```bash
Success {
  '$metadata': {
    httpStatusCode: 200,
    requestId: 'H4DHV61DTTES539P',
    extendedRequestId: 'vVDUOTQ8xWFKepIh20pPNwRQxcC1eDinXuqXxjKAOy3H8L+ssCipCmoF0MiXygRcPv+deQkBcCk=',
    cfId: undefined,
    attempts: 1,
    totalRetryDelay: 0
  },
  Buckets: [
    {
      Name: 'bucket-1-2021-10-12',
      CreationDate: 2023-12-20T12:42:05.000Z
    }
  ],
  Owner: {
    DisplayName: 'qiuyanxi1992',
    ID: 'd74d029e781c3ee592f3469502fae45404c41279d20e5944ef5e338767f97493'
  }
}
```

ÂàõÂª∫Â•Ω budget ÂêéÔºåÂ∞±ÂèØ‰ª•‰∏ä‰º†Êñá‰ª∂‰∫Ü„ÄÇ

Â∞ÜÊñá‰ª∂‰∏ä‰º†Ëá≥ S3 ÊúâÂæàÂ§öÁßçÊ∏†ÈÅìÔºö

- s3.upload
- s3.putObject
- ÈÄöËøá signedUrl

...

Â§ßÈÉ®ÂàÜÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨ÈÉΩÂèØ‰ª•‰ΩøÁî®`signedUrl`Êù•‰∏ä‰º†„ÄÇÂÆÉÁöÑÈÄªËæëÊòØËøôÊ†∑ÁöÑÔºö

1. ÂâçÁ´ØÂêëÂêéÁ´ØÂèëÈÄÅËØ∑Ê±Ç‰ª•Ëé∑ÂèñÁ≠æÂêç Url

2. ÂêéÁ´ØËé∑ÂèñÁ≠æÂêç Url ÂêéÂèëÈÄÅÂõûÂâçÁ´Ø

   ```js
   import { getSignedUrl } from '@aws-sdk/s3-request-presigner'

   const command = new PutObjectCommand({
     Bucket: BUCKET_NAME,
     Key: 'example.txt',
   })

   const run = async () => {
     try {
       const url = await getSignedUrl(s3Client, command, { expiresIn: 3600 })
       console.log('Success', url)
     } catch (err) {
       console.log('Error', err)
     }
   }
   ```

3. ÂâçÁ´ØÁõ¥Êé•Â∞ÜÊñá‰ª∂ÂèëÈÄÅËá≥Á≠æÂêç Url

   ```js
   import https from 'https'

   function put(url, data) {
     return new Promise((resolve, reject) => {
       const req = https.request(
         url,
         { method: 'PUT', headers: { 'Content-Length': new Blob([data]).size } },
         (res) => {
           let responseBody = ''
           res.on('data', (chunk) => {
             responseBody += chunk
           })
           res.on('end', () => {
             resolve(responseBody)
           })
         },
       )
       req.on('error', (err) => {
         reject(err)
       })
       req.write(data)
       req.end()
     })
   }

   await put(data, '123')
   ```

4. Êñá‰ª∂ÈÄöËøáÁ≠æÂêç Url ‰º†ËæìÂà∞ S3 ‰∏≠

[ÂÆòÊñπÁ§∫‰æã‰ª£Á†Å](https://github.com/awsdocs/aws-doc-sdk-examples/blob/main/javascriptv3/example_code/s3/scenarios/presigned-url-upload.js)

## ‰ªé S3 ‰∏ãËΩΩÊñá‰ª∂

‰ªé S3 ‰∏ãËΩΩÊñá‰ª∂ÂêåÊ†∑ËÉΩÂ§ü‰ΩøÁî® signedUrl Êù•Ëé∑Âèñ‰∏ãËΩΩÈìæÊé•ÔºåÊ†∏ÂøÉ‰ª£Á†ÅÔºö

```js
const command = new GetObjectCommand({
  Bucket: BUCKET_NAME,
  Key: 'example.txt',
})

const clientUrl = await getSignedUrl(s3Client, command, {
  expiresIn: 3600,
})
console.log('‚Äî‚Äî‚Äî‚Äî‚Äî‚ÄîüöÄüöÄüöÄüöÄüöÄ ‚Äî‚Äî clientUrl:', clientUrl)
```

ÂâçÁ´ØÊãøÂà∞ URL ÂêéÁõ¥Êé•Ë∞ÉÁî® fetch Êù•‰∏ãËΩΩ

```js
function download(href, filename = '') {
  const a = document.createElement('a')
  a.download = filename
  a.href = href
  document.body.appendChild(a)
  a.click()
  a.remove()
}

function downloadFile(url, filename = '') {
  fetch(url)
    .then((res) => res.blob())
    .then((blob) => {
      const blobUrl = window.URL.createObjectURL(blob)
      download(blobUrl, filename)
      window.URL.revokeObjectURL(blobUrl)
    })
}
```

[ÂÆòÊñπÁ§∫‰æã‰ª£Á†Å](https://github.com/awsdocs/aws-doc-sdk-examples/blob/main/javascriptv3/example_code/s3/scenarios/presigned-url-download.js)
